GO

SET NOCOUNT ON

SET IDENTITY_INSERT [ShopProduct] ON

MERGE INTO [ShopProduct] AS Target
USING (VALUES
  (1,4204.00000,81,23)
 ,(2,1491.00000,49,41)
 ,(3,453.00000,99,62)
 ,(4,3018.00000,1,62)
 ,(5,3257.00000,39,21)
 ,(6,3964.00000,55,80)
 ,(7,2170.00000,91,12)
 ,(8,1594.00000,55,57)
 ,(9,2362.00000,95,74)
 ,(10,557.00000,7,19)
 ,(11,3049.00000,52,100)
 ,(12,1295.00000,23,87)
 ,(13,951.00000,65,52)
 ,(14,4683.00000,54,63)
 ,(15,1445.00000,80,9)
 ,(16,2206.00000,16,90)
 ,(17,2796.00000,34,47)
 ,(18,2004.00000,6,9)
 ,(19,2784.00000,76,81)
 ,(20,398.00000,55,81)
 ,(21,1731.00000,47,8)
 ,(22,1008.00000,90,67)
 ,(23,3591.00000,72,30)
 ,(24,801.00000,64,17)
 ,(25,1950.00000,12,40)
 ,(26,2661.00000,55,79)
 ,(27,1303.00000,25,87)
 ,(28,3205.00000,51,97)
 ,(29,1120.00000,63,76)
 ,(30,4600.00000,88,9)
 ,(31,1858.00000,90,73)
 ,(32,2799.00000,39,53)
 ,(33,2394.00000,30,4)
 ,(34,2903.00000,95,87)
 ,(35,2007.00000,12,78)
 ,(36,4596.00000,28,20)
 ,(37,2528.00000,41,39)
 ,(38,4892.00000,36,70)
 ,(39,1267.00000,11,80)
 ,(40,2915.00000,77,41)
 ,(41,677.00000,31,18)
 ,(42,251.00000,83,88)
 ,(43,4809.00000,6,13)
 ,(44,1613.00000,50,17)
 ,(45,4534.00000,37,25)
 ,(46,1612.00000,73,6)
 ,(47,3161.00000,49,91)
 ,(48,1307.00000,21,62)
 ,(49,2021.00000,24,89)
 ,(50,1048.00000,53,71)
 ,(51,2357.00000,73,92)
 ,(52,1329.00000,75,12)
 ,(53,2579.00000,84,46)
 ,(54,3479.00000,98,67)
 ,(55,357.00000,98,69)
 ,(56,1064.00000,94,32)
 ,(57,3121.00000,83,81)
 ,(58,1901.00000,96,31)
 ,(59,1253.00000,97,70)
 ,(60,3388.00000,28,51)
 ,(61,4257.00000,60,21)
 ,(62,4325.00000,8,63)
 ,(63,2986.00000,55,40)
 ,(64,3027.00000,31,22)
 ,(65,1551.00000,35,33)
 ,(66,1872.00000,60,11)
 ,(67,4145.00000,23,19)
 ,(68,1406.00000,82,52)
 ,(69,3362.00000,71,18)
 ,(70,2303.00000,30,72)
 ,(71,4592.00000,91,32)
 ,(72,2120.00000,39,91)
 ,(73,3432.00000,85,67)
 ,(74,4887.00000,66,31)
 ,(75,1288.00000,73,2)
 ,(76,4203.00000,54,92)
 ,(77,1713.00000,87,47)
 ,(78,4774.00000,63,17)
 ,(79,548.00000,88,10)
 ,(80,3077.00000,88,76)
 ,(81,4026.00000,56,63)
 ,(82,3598.00000,50,41)
 ,(83,4698.00000,36,4)
 ,(84,3882.00000,62,71)
 ,(85,4829.00000,3,26)
 ,(86,3921.00000,65,88)
 ,(87,1226.00000,79,38)
 ,(88,898.00000,100,17)
 ,(89,1394.00000,20,85)
 ,(90,3901.00000,40,33)
 ,(91,4001.00000,76,69)
 ,(92,3716.00000,34,91)
 ,(93,906.00000,22,69)
 ,(94,254.00000,19,85)
 ,(95,4828.00000,57,3)
 ,(96,4867.00000,33,23)
 ,(97,1409.00000,28,31)
 ,(98,3465.00000,42,74)
 ,(99,4123.00000,68,31)
 ,(100,690.00000,11,73)
 ,(101,3468.00000,30,39)
 ,(102,3848.00000,33,29)
 ,(103,4346.00000,27,73)
 ,(104,2925.00000,51,99)
 ,(105,432.00000,82,16)
 ,(106,2791.00000,73,31)
 ,(107,2839.00000,55,37)
 ,(108,807.00000,13,49)
 ,(109,1114.00000,3,35)
 ,(110,4799.00000,93,74)
 ,(111,3270.00000,41,84)
 ,(112,1714.00000,88,16)
 ,(113,4274.00000,41,4)
 ,(114,391.00000,88,32)
 ,(115,3354.00000,75,78)
 ,(116,4163.00000,69,36)
 ,(117,1111.00000,73,87)
 ,(118,517.00000,35,72)
 ,(119,3823.00000,93,94)
 ,(120,4325.00000,84,27)
 ,(121,3803.00000,69,73)
 ,(122,4177.00000,7,39)
 ,(123,959.00000,40,95)
 ,(124,3915.00000,58,27)
 ,(125,3786.00000,21,13)
 ,(126,1329.00000,8,52)
 ,(127,4044.00000,20,69)
 ,(128,1506.00000,6,9)
 ,(129,1173.00000,82,11)
 ,(130,734.00000,71,63)
 ,(131,2336.00000,48,58)
 ,(132,2051.00000,57,96)
 ,(133,2788.00000,50,31)
 ,(134,2885.00000,29,75)
 ,(135,4777.00000,88,58)
 ,(136,653.00000,88,68)
 ,(137,3917.00000,59,3)
 ,(138,4539.00000,7,24)
 ,(139,1661.00000,43,9)
 ,(140,2982.00000,96,28)
 ,(141,1062.00000,49,9)
 ,(142,2679.00000,30,83)
 ,(143,1737.00000,10,78)
 ,(144,1521.00000,28,79)
 ,(145,3995.00000,32,87)
 ,(146,1192.00000,29,99)
 ,(147,276.00000,43,67)
 ,(148,3178.00000,60,17)
 ,(149,2380.00000,35,58)
 ,(150,2356.00000,99,62)
 ,(151,3976.00000,89,77)
 ,(152,2625.00000,60,26)
 ,(153,4619.00000,97,51)
 ,(154,1273.00000,9,68)
 ,(155,267.00000,27,36)
 ,(156,1039.00000,38,7)
 ,(157,3998.00000,18,39)
 ,(158,1507.00000,52,76)
 ,(159,502.00000,76,57)
 ,(160,2996.00000,12,56)
 ,(161,3253.00000,84,42)
 ,(162,1083.00000,64,37)
 ,(163,4290.00000,28,50)
 ,(164,1823.00000,75,23)
 ,(165,3078.00000,86,10)
 ,(166,3392.00000,49,88)
 ,(167,3656.00000,97,19)
 ,(168,4798.00000,17,20)
 ,(169,810.00000,15,89)
 ,(170,873.00000,32,46)
 ,(171,593.00000,27,61)
 ,(172,1572.00000,52,52)
 ,(173,3065.00000,97,83)
 ,(174,951.00000,1,31)
 ,(175,593.00000,36,86)
 ,(176,4069.00000,17,84)
 ,(177,1529.00000,75,13)
 ,(178,4729.00000,67,6)
 ,(179,1210.00000,48,12)
 ,(180,4175.00000,5,10)
 ,(181,2180.00000,2,43)
 ,(182,4235.00000,78,50)
 ,(183,2752.00000,41,88)
 ,(184,2933.00000,61,3)
 ,(185,2184.00000,53,100)
 ,(186,2268.00000,30,41)
 ,(187,4023.00000,70,97)
 ,(188,2400.00000,4,42)
 ,(189,361.00000,36,14)
 ,(190,1630.00000,66,100)
 ,(191,3392.00000,23,69)
 ,(192,3015.00000,56,41)
 ,(193,3734.00000,42,100)
 ,(194,277.00000,17,5)
 ,(195,2511.00000,28,24)
 ,(196,753.00000,86,47)
 ,(197,4171.00000,59,70)
 ,(198,3796.00000,51,62)
 ,(199,1255.00000,87,56)
 ,(200,2006.00000,57,43)
) AS Source ([ShopProductID],[Price],[ShopID],[ProductID])
ON (Target.[ShopProductID] = Source.[ShopProductID])
WHEN MATCHED AND (
	NULLIF(Source.[Price], Target.[Price]) IS NOT NULL OR NULLIF(Target.[Price], Source.[Price]) IS NOT NULL OR 
	NULLIF(Source.[ShopID], Target.[ShopID]) IS NOT NULL OR NULLIF(Target.[ShopID], Source.[ShopID]) IS NOT NULL OR 
	NULLIF(Source.[ProductID], Target.[ProductID]) IS NOT NULL OR NULLIF(Target.[ProductID], Source.[ProductID]) IS NOT NULL) THEN
 UPDATE SET
  [Price] = Source.[Price], 
  [ShopID] = Source.[ShopID], 
  [ProductID] = Source.[ProductID]
WHEN NOT MATCHED BY TARGET THEN
 INSERT([ShopProductID],[Price],[ShopID],[ProductID])
 VALUES(Source.[ShopProductID],Source.[Price],Source.[ShopID],Source.[ProductID])
WHEN NOT MATCHED BY SOURCE THEN 
 DELETE
;
GO
DECLARE @mergeError int
 , @mergeCount int
SELECT @mergeError = @@ERROR, @mergeCount = @@ROWCOUNT
IF @mergeError != 0
 BEGIN
 PRINT 'ERROR OCCURRED IN MERGE FOR [ShopProduct]. Rows affected: ' + CAST(@mergeCount AS VARCHAR(100)); -- SQL should always return zero rows affected
 END
ELSE
 BEGIN
 PRINT '[ShopProduct] rows affected by MERGE: ' + CAST(@mergeCount AS VARCHAR(100));
 END
GO

SET IDENTITY_INSERT [ShopProduct] OFF
GO
SET NOCOUNT OFF
GO

